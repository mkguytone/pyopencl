<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>13.18. NDRange</title><link rel="stylesheet" type="text/css" href="index.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Python OpenCL入門" /><link rel="up" href="ch13.html" title="Chapter 13. OpenCLの概要" /><link rel="prev" href="ch13s17.html" title="13.17. ワークグループ" /><link rel="next" href="ch13s19.html" title="13.19. メモリー領域" /><meta xmlns="" name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0" /><script xmlns="" type="text/javascript" src="prettify/prettify.js"></script><link xmlns="" rel="stylesheet" type="text/css" href="prettify/skins/sons-of-obsidian.css" /><script xmlns="">
    window.addEventListener("load", function() {
      PR.prettyPrint();
	  });	
	</script><script xmlns="" type="text/javascript" src="script/head.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch13s17.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch13s19.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ndrangeChapter"></a>13.18. NDRange</h2></div></div></div><p>データ並列プログラミングをOpenCLで実装するにはNDRange、つまりN次元（N-dimensional）の範囲を定義してカーネルのインスタンスを組成させます。他の言葉で表現するならば、Nを1にする場合、1次元の範囲のデータに対して並列処理を求めたいということを定義します。</p><p>１次元と定義した（線形）ベクトルのデータ（又は単にC言語でいう配列）数が例えば512個で、さらに全ての配列要素に対して並列・並行に処理をするならば、ワークアイテムは最低でも512個以上必要となります。</p><p>Nが2以上となるのは、画像データを取り扱う時です。この場合は、256x2、128x4、64x8、32x16といったように各次元のワークアイテムサイズを削減します。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ndrange_１次元"></a>13.18.1. NDRange：１次元</h3></div></div></div><p>１次元については「図表：ワークグループ（１次元）」（<a class="xref" href="ch13s17.html#workgroup" title="Figure 13.5. 図表：ワークグループ（１次元）">Figure 13.5, “図表：ワークグループ（１次元）”</a>）に記述した構成となります。</p><p>ワークグループをn個にすれば、演算する空間がn個に分割されます。各ワークグループの要素を指定するにはローカルIDを使うことで、ワークアイテムを指定しアクセスできます。</p><p>ワークグループ数が０個の場合は、全ての配列要素に対して並列・並行に処理をするためにOpenCL-C言語で以下のように、配列のインデックス（添字）をグローバルIDとして取得します。</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>詳しくは「表：ワークアイテム・グループ関数」（<a class="xref" href="apbs38.html#workitem" title="Table B.102. 表：ワークアイテム・グループ関数">Table B.102, “表：ワークアイテム・グループ関数”</a>）を参照ください。</p></div><pre xmlns="" class="prettyprint">size_t id = get_global_id(0);
output[id] = input[id] * 2;</pre><p>ここではget_global_id関数を使ってグローバルIDを取得します。</p><p>0 と引数を指定していますが 1 次元の NDRange に相当します。</p><p>各 id は OpenCL実装ライブラリが内部で割り当てるスレッド番号とでも考えてください。</p><p>コードの内容としては input 配列の各要素の 2 倍を output 配列の各要素に代入しています。</p><p>ローカルIDを使っていないためワークグループはこの例では１つと推定できます。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ndrange_２次元"></a>13.18.2. NDRange：２次元</h3></div></div></div><p>2次元は以下の図のように2次元（8x8ピクセル）の映像を並列処理することに使うことができます。図では、ワークグループが４つの、4x4ピクセルの2次元のNDRangeとなります。左上が、workgroup-0、右上がworkgroup-1、右下がworkgroup-3となります。</p><div class="figure"><a id="twodim"></a><p class="title"><strong>Figure 13.6. 図表：NDRange2次元</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/OpenCLND2D.png" alt="images/OpenCLND2D.png" /></div></div></div><br class="figure-break" /><p>例えば2x128、3x64、8x32の2次元行列データがあるとします。上図二示した例でいえば、行8x列8の2次元イメージデータがをしなくてはいけないので、Nは2とします。</p><p>2次元イメージのインデックス（添字）はOpenCL-C言語では以下のように取得します。OpenCL-C言語については後半の章で解説します。</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>詳しくは「表：ワークアイテム・グループ関数」（<a class="xref" href="apbs38.html#workitem" title="Table B.102. 表：ワークアイテム・グループ関数">Table B.102, “表：ワークアイテム・グループ関数”</a>）を参照ください。</p></div><pre xmlns="" class="prettyprint">size_t x = get_global_id(0);
size_t y = get_global_id(1);</pre><p>変数xとyは(x,y)座標として使用することができます。ワークグループと関係なく、グローバルに割り振られた座標を示します。以下の表は2次元（8 x 8）の場合のグローバルIDの展開した結果となります。</p><div class="table"><a id="idm3626"></a><p class="title"><strong>Table 13.16. グローバルID（8 x 8）</strong></p><div class="table-contents"><table class="table" summary="グローバルID（8 x 8）" cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /><col class="col_5" /><col class="col_6" /><col class="col_7" /><col class="col_8" /></colgroup><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>0,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>1,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>2,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>3,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>4,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>5,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>6,0</em></span></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>7,0</em></span></p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>0,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>1,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>2,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>3,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>4,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>5,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>6,1</em></span></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>7,1</em></span></p></td></tr><tr><td style="" colspan="8" align="left" valign="top"><p><span class="emphasis"><em>以下続く</em></span></p></td></tr></tbody></table></div></div><br class="table-break" /><p>ローカルIDを２次元（4 x 4）とする場合は下図のようにインデックス空間を表すことができます。</p><div class="table"><a id="idm3693"></a><p class="title"><strong>Table 13.17. ローカルID（4 x 4）：ワークグループ個数（4）</strong></p><div class="table-contents"><table class="table" summary="ローカルID（4 x 4）：ワークグループ個数（4）" cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /><col class="col_5" /><col class="col_6" /><col class="col_7" /><col class="col_8" /></colgroup><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>0,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>1,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>2,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>3,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>0,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>1,0</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>2,0</em></span></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>3,0</em></span></p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>0,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>1,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>2,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>3,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>0,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>1,1</em></span></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>2,1</em></span></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="emphasis"><em>3,1</em></span></p></td></tr><tr><td style="" colspan="8" align="left" valign="top"><p><span class="emphasis"><em>以下続く</em></span></p></td></tr></tbody></table></div></div><br class="table-break" /><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>詳しくは「表：ワークアイテム・グループ関数」（<a class="xref" href="apbs38.html#workitem" title="Table B.102. 表：ワークアイテム・グループ関数">Table B.102, “表：ワークアイテム・グループ関数”</a>）を参照ください。</p></div><p><a id="ndrangekernel"></a><strong>NDRangeカーネル. </strong>
</p><pre xmlns="" class="prettyprint">__kernel void ndrange_id(__global write_only float *output) {

   size_t global_id_0 = get_global_id(0);
   size_t global_id_1 = get_global_id(1);
   size_t global_id_2 = get_global_id(2);

   printf("GlobalIDs (%d:%d:%d)\n", global_id_0, global_id_1, global_id_2);

   size_t local_id_0 = get_local_id(0);
   size_t local_id_1 = get_local_id(1);
   size_t local_id_2 = get_local_id(2);

   printf("LocalIDs (%d:%d:%d)\n", local_id_0, local_id_1, local_id_2);

}</pre><p>
</p><p><strong>出力. </strong>
</p><pre xmlns="" class="prettyprint">GlobalIDs (0:0:0)
GlobalIDs (1:0:0)
GlobalIDs (2:0:0)
GlobalIDs (3:0:0)
GlobalIDs (0:1:0)
GlobalIDs (1:1:0)
GlobalIDs (2:1:0)
GlobalIDs (3:1:0)
GlobalIDs (0:2:0)
GlobalIDs (1:2:0)
GlobalIDs (2:2:0)
GlobalIDs (3:2:0)
GlobalIDs (0:3:0)
GlobalIDs (1:3:0)
GlobalIDs (2:3:0)
GlobalIDs (3:3:0)
GlobalIDs (0:4:0)
GlobalIDs (1:4:0)
GlobalIDs (2:4:0)
GlobalIDs (3:4:0)
GlobalIDs (0:5:0)
GlobalIDs (1:5:0)
GlobalIDs (2:5:0)
GlobalIDs (3:5:0)
GlobalIDs (0:6:0)
GlobalIDs (1:6:0)
GlobalIDs (2:6:0)
GlobalIDs (3:6:0)
GlobalIDs (0:7:0)
GlobalIDs (1:7:0)
GlobalIDs (2:7:0)
GlobalIDs (3:7:0)
GlobalIDs (4:0:0)
GlobalIDs (5:0:0)
GlobalIDs (6:0:0)
GlobalIDs (7:0:0)
GlobalIDs (4:1:0)
GlobalIDs (5:1:0)
GlobalIDs (6:1:0)
GlobalIDs (7:1:0)
GlobalIDs (4:2:0)
GlobalIDs (5:2:0)
GlobalIDs (6:2:0)
GlobalIDs (7:2:0)
GlobalIDs (4:3:0)
GlobalIDs (5:3:0)
GlobalIDs (6:3:0)
GlobalIDs (7:3:0)
GlobalIDs (4:4:0)
GlobalIDs (5:4:0)
GlobalIDs (6:4:0)
GlobalIDs (7:4:0)
GlobalIDs (4:5:0)
GlobalIDs (5:5:0)
GlobalIDs (6:5:0)
GlobalIDs (7:5:0)
GlobalIDs (4:6:0)
GlobalIDs (5:6:0)
GlobalIDs (6:6:0)
GlobalIDs (7:6:0)
GlobalIDs (4:7:0)
GlobalIDs (5:7:0)
GlobalIDs (6:7:0)
GlobalIDs (7:7:0)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (2:0:0)
LocalIDs (3:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (2:1:0)
LocalIDs (3:1:0)
LocalIDs (0:2:0)
LocalIDs (1:2:0)
LocalIDs (2:2:0)
LocalIDs (3:2:0)
LocalIDs (0:3:0)
LocalIDs (1:3:0)
LocalIDs (2:3:0)
LocalIDs (3:3:0)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (2:0:0)
LocalIDs (3:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (2:1:0)
LocalIDs (3:1:0)
LocalIDs (0:2:0)
LocalIDs (1:2:0)
LocalIDs (2:2:0)
LocalIDs (3:2:0)
LocalIDs (0:3:0)
LocalIDs (1:3:0)
LocalIDs (2:3:0)
LocalIDs (3:3:0)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (2:0:0)
LocalIDs (3:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (2:1:0)
LocalIDs (3:1:0)
LocalIDs (0:2:0)
LocalIDs (1:2:0)
LocalIDs (2:2:0)
LocalIDs (3:2:0)
LocalIDs (0:3:0)
LocalIDs (1:3:0)
LocalIDs (2:3:0)
LocalIDs (3:3:0)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (2:0:0)
LocalIDs (3:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (2:1:0)
LocalIDs (3:1:0)
LocalIDs (0:2:0)
LocalIDs (1:2:0)
LocalIDs (2:2:0)
LocalIDs (3:2:0)
LocalIDs (0:3:0)
LocalIDs (1:3:0)
LocalIDs (2:3:0)
LocalIDs (3:3:0)</pre><p>
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ndrange_３次元"></a>13.18.3. NDRange：３次元</h3></div></div></div><p>NDRangeのN=3はOpenGLやDirectXなどで使う3次元画像データの処理に適しています。</p><div class="figure"><a id="threedim"></a><p class="title"><strong>Figure 13.7. 図表：NDRange3次元</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/OpenCL3DNDpng.png" alt="images/OpenCL3DNDpng.png" /></div></div></div><br class="figure-break" /><p>以下の表では、64個のカーネルインスタンス（ワークアイテム）に対して、8個のワークグループとして、各ワークグループに割り当てたワークアイテムは8としました。</p><p>「NDRangeカーネル」(<a class="xref" href="ch13s18.html#ndrangekernel" title="NDRangeカーネル">NDRangeカーネル</a>)を実行した場合の出力です。</p><p><strong>グローバルID（4 x 4 x 4）、ローカルID（2 x 2 x 2）. </strong>
</p><pre xmlns="" class="prettyprint">LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)
LocalIDs (0:0:0)
LocalIDs (1:0:0)
LocalIDs (0:1:0)
LocalIDs (1:1:0)
LocalIDs (0:0:1)
LocalIDs (1:0:1)
LocalIDs (0:1:1)
LocalIDs (1:1:1)</pre><p>
</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch13s17.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch13.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch13s19.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div><wrapper xmlns=""><p>Copyright 2018-2019, by Masaki Komatsu</p>


</wrapper></body></html>